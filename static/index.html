<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Python Chat</title>
  <style>
    body { font-family: sans-serif; max-width: 700px; margin: 20px auto; }
    #messages { border: 1px solid #ccc; height: 400px; overflow-y: auto; padding: 10px; }
    .msg { margin-bottom: 8px; }
    .username { font-weight: bold; margin-right: 5px; }
  </style>
</head>
<body>
  <h2>Python Chat</h2>
  <input id="username" placeholder="Name" />
  <div id="messages"></div>
  <input id="text" placeholder="Nachricht..." />
  <button id="send">Senden</button>

<script>
  const usernameInput = document.getElementById('username');
  const textInput = document.getElementById('text');
  const sendButton = document.getElementById('send');
  const messagesDiv = document.getElementById('messages');

  const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
  const wsUrl = wsProtocol + '//' + location.host + '/ws';
  const ws = new WebSocket(wsUrl);

  ws.onmessage = (event) => {
    const msg = JSON.parse(event.data);
    const div = document.createElement('div');
    div.classList.add('msg');
    div.innerHTML = `<span class="username">${msg.username}</span>: ${msg.content}`;
    messagesDiv.appendChild(div);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  };

  sendButton.onclick = () => {
    const username = usernameInput.value.trim() || 'Anonymous';
    const content = textInput.value.trim();
    if (content) {
      ws.send(JSON.stringify({ username, content }));
      textInput.value = '';
    }
  };

  textInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') sendButton.click();
  });
</script>
</body>
</html>
